================================================================================
                    XPCS VIEWER - TEST COVERAGE SUMMARY
                         Legacy Components Analysis
================================================================================

EXECUTIVE SUMMARY
─────────────────────────────────────────────────────────────────────────────

Priority Level: CRITICAL - Core modules have insufficient test coverage

Key Metrics:
  • XpcsFile class: 39 public methods, 5% actual coverage
  • ViewerKernel class: 28 public methods, 4% actual coverage
  • Total Untested Critical Methods: 64 out of 107
  • Test-to-Method Ratio: 2.5:1 (lots of tests, sparse coverage)

================================================================================
                           MODULE COVERAGE TABLE
================================================================================

Module                          Methods  Tests  Coverage  Priority
─────────────────────────────────────────────────────────────────────────────
xpcsviewer/xpcs_file.py         39       39     5%       P1 (CRITICAL)
  - G2 Data Access              12       0      0%       UNTESTED
  - Fitting Operations          8        0      0%       UNTESTED
  - ROI Extraction              6        0      0%       UNTESTED
  - Cache Management            3        0      0%       UNTESTED
  - Initialization/String       10       39     100%     OK

xpcsviewer/viewer_kernel.py     28       50     4%       P1 (CRITICAL)
  - Plotting Methods            9        0      0%       UNTESTED
  - Export Methods              3        0      0%       UNTESTED
  - Data Retrieval              4        0      0%       UNTESTED
  - ROI/Geometry                2        0      0%       UNTESTED
  - Job Management              4        0      0%       UNTESTED
  - Initialization/Metadata     6        50     100%     OK

xpcsviewer/module/g2mod.py      11       82     35%      P1 (MODERATE)
  - Data Access                 2        2      100%     OK
  - Plotting/Analysis           6        5      83%      OK
  - Batch Operations            3        0      0%       UNTESTED

xpcsviewer/module/twotime.py    4        30     30%      P2 (MODERATE)
  - Visualization               2        0      0%       UNTESTED
  - Data Processing             2        2      100%     OK

xpcsviewer/fileIO/hdf_reader.py 25+      85     20%      P2 (GOOD)
  - Connection Pooling          8        8      100%     OK
  - Health/Cache                8        8      100%     OK
  - Advanced Operations         9+       1      11%      GAPS

xpcsviewer/fileIO/qmap_utils.py 20+      50     40%      P2 (GOOD)
  - QMap IO                     12       8      67%      OK
  - Computation                 8        42     100%     OK

xpcsviewer/module/saxs1d.py     10       24     40%      P2 (MODERATE)
  - Basic Analysis              7        14     100%     OK
  - ROI Optimization            3        0      0%       UNTESTED

xpcsviewer/module/saxs2d.py     1        24     100%     OK

================================================================================
                        CRITICAL UNTESTED METHODS
================================================================================

XpcsFile (39 methods → 37 untested)
───────────────────────────────────────────────────────────────────────────

DATA ACCESS (12 UNTESTED):
  ✗ get_g2_data(qrange, trange)              -> Core analysis feature
  ✗ get_g2_stability_data(qrange, trange)    -> Stability analysis
  ✗ get_twotime_c2(selection, correct_diag)  -> TwoTime analysis
  ✗ get_twotime_stream(**kwargs)             -> Memory-efficient access
  ✗ get_cropped_qmap(target, enabled)        -> Q-map processing
  ✗ get_offseted_g2(normalization)           -> G2 normalization
  ✗ get_roi_data(roi_parameter, phi_num)     -> ROI extraction
  ✗ get_multiple_roi_data_parallel(...)      -> Parallel ROI
  ✗ get_info_at_position(x, y)               -> Position info
  ✗ get_detector_extent()                    -> Detector geometry
  ✗ get_fitting_info(mode)                   -> Fit metadata
  ✗ get_pg_tree()                            -> GUI tree

FITTING/ANALYSIS (8 UNTESTED):
  ✗ fit_g2(...)                              -> Core fitting (CRITICAL)
  ✗ fit_g2_robust(...)                       -> Robust fitting
  ✗ fit_g2_high_performance(...)             -> Performance variant
  ✗ fit_tauq(q_range, bounds, fit_flag)     -> Q-dependent fitting
  ✗ correct_g2_err(g2_err, threshold)        -> Error correction
  ✗ norm_saxs_data(q, Iq, norm_method)       -> SAXS normalization

EXPORT (6 UNTESTED):
  ✗ export_saxs1d(roi_list, folder)          -> SAXS 1D export
  ✗ [indirect exports via ROI]                -> Data export pipeline

CACHE (3 UNTESTED):
  ✗ clear_cache(cache_type)                  -> Memory management
  ✗ get_cache_stats()                        -> Cache info
  ✗ [caching internals]                      -> Performance

ViewerKernel (28 methods → 27 untested)
───────────────────────────────────────────────────────────────────────────

PLOTTING (9 UNTESTED - CRITICAL):
  ✗ plot_g2(handler, q_range, t_range, ...)              -> Core plotting
  ✗ plot_g2_stability(mp_hdl, rows)                      -> Stability plot
  ✗ plot_g2map(hdl, rows, target)                        -> G2 map plot
  ✗ plot_saxs_1d(pg_hdl, mp_hdl)                         -> SAXS 1D plot
  ✗ plot_saxs_2d(*args, rows, **kwargs)                  -> SAXS 2D plot
  ✗ plot_twotime(hdl, rows, **kwargs)                    -> TwoTime plot
  ✗ plot_intt(pg_hdl, rows, **kwargs)                    -> Intensity plot
  ✗ plot_stability(mp_hdl, rows, **kwargs)               -> Stability plot
  ✗ plot_qmap(hdl, rows, target)                         -> Q-map plot

DATA ACCESS (4 UNTESTED):
  ✗ get_info_at_mouse(rows, x, y)            -> Mouse hover info
  ✗ get_pg_tree()                            -> PyQtGraph tree
  ✗ get_fitting_tree()                       -> Fitting tree
  ✗ get_memory_stats()                       -> Memory info

EXPORT (3 UNTESTED):
  ✗ export_g2(folder, rows)                  -> G2 export
  ✗ export_saxs_1d(pg_hdl, folder)           -> SAXS 1D export
  ✗ export_diffusion(folder, rows)           -> Diffusion export

ROI/GEOMETRY (2 UNTESTED):
  ✗ add_roi(hdl, **kwargs)                   -> ROI addition
  ✗ plot_tauq_pre(hdl, rows)                 -> Preprocessing

OTHER (9 UNTESTED):
  ✗ switch_saxs1d_line(mp_hdl, lb_type)      -> Line switching
  ✗ submit_job(*args, **kwargs)              -> Job submission
  ✗ remove_job(index)                        -> Job removal
  ✗ update_avg_info(jid)                     -> Average info
  ✗ update_avg_values(data)                  -> Average values
  ✗ [5 more utility/internal methods]

================================================================================
                        IDENTIFIED RISK AREAS
================================================================================

CRITICAL RISKS (Block Release):
─────────────────────────────────────────────────────────────────────────────

1. G2 ANALYSIS PIPELINE (No Tests)
   Path: load → normalize → fit → export
   Methods affected: get_g2_data(), fit_g2(), correct_g2_err()
   Impact: Core XPCS analysis feature unavailable for validation
   Manual testing: Via GUI only

2. SAXS ROI EXTRACTION (Minimal Tests)
   Path: load → define ROI → extract → normalize → export
   Methods affected: get_roi_data(), get_multiple_roi_data_parallel()
   Impact: Custom analysis workflows not validated
   Manual testing: Via GUI only

3. VISUALIZATION PIPELINE (No Tests)
   Path: load → plot (9 different plot types)
   Methods affected: All plot_*() methods in ViewerKernel
   Impact: All visualization untested, regressed features hard to detect
   Manual testing: Via GUI only

4. TWOTIME ANALYSIS (Partial Tests)
   Path: load → correct → visualize → export
   Methods affected: plot_twotime(), plot_twotime_g2()
   Impact: TwoTime visualization untested
   Manual testing: Indirect only

HIGH RISKS (Moderate Priority):
─────────────────────────────────────────────────────────────────────────────

5. FITTING ROBUSTNESS (No Tests)
   Methods affected: fit_g2(), fit_g2_robust(), fit_tauq()
   Impact: Fitting failures not caught until GUI use
   Variants: Single-exp, Double-exp, Power-law

6. MEMORY MANAGEMENT (No Tests)
   Methods affected: clear_cache(), cache operations
   Impact: Memory pressure scenarios not validated
   Risk: OOM crashes under stress

7. PARALLEL ROI EXTRACTION (No Tests)
   Methods affected: get_multiple_roi_data_parallel()
   Impact: Performance features not validated
   Risk: Race conditions, deadlocks not detected

8. JOB MANAGEMENT (No Tests)
   Methods affected: submit_job(), update_avg_info()
   Impact: Long-running operations not validated
   Risk: Silent failures, data corruption

================================================================================
                        TESTING RECOMMENDATIONS
================================================================================

PHASE 1: CRITICAL PATHS (Sprint 1-2) - 8 Priority Tests
───────────────────────────────────────────────────────

XpcsFile Fixes:
  1. test_get_g2_data_basic()
  2. test_fit_g2_single_exponential()
  3. test_fit_g2_double_exponential()
  4. test_get_g2_stability_data()
  5. test_get_roi_data_single()
  6. test_get_multiple_roi_data_parallel()
  7. test_get_twotime_c2()
  8. test_export_saxs1d()

ViewerKernel Fixes:
  9. test_plot_g2_with_valid_data()
  10. test_plot_saxs_1d_with_valid_data()
  11. test_plot_saxs_2d_with_valid_data()
  12. test_plot_twotime_with_valid_data()
  13. test_add_roi_ring()
  14. test_add_roi_sector()
  15. test_export_g2_to_file()
  16. test_export_saxs_1d_to_file()

Estimated Effort: 40-50 test cases, 60 hours
Target Coverage: 50% for both modules


PHASE 2: INTEGRATION TESTS (Sprint 3-4) - 4 Pipelines
──────────────────────────────────────────────────────

1. G2 Analysis Pipeline
   load_file() → get_g2_data() → fit_g2() → export_g2()

2. SAXS ROI Extraction
   load_file() → define_roi() → get_roi_data() → export_saxs1d()

3. TwoTime Analysis
   load_file() → get_twotime_c2() → plot_twotime_g2() → export_diffusion()

4. Memory Management
   load_large_file() → streaming_access() → cleanup_cache()

Estimated Effort: 20-30 test cases, 40 hours


PHASE 3: EDGE CASES & ERROR HANDLING (Sprint 5-6)
──────────────────────────────────────────────────

Error Scenarios:
  • Corrupted HDF5 files
  • Missing data fields
  • Out-of-memory conditions
  • Invalid parameter ranges
  • Concurrent access conflicts
  • File handle exhaustion

Estimated Effort: 30-40 test cases, 50 hours

================================================================================
                          COVERAGE TARGETS
================================================================================

Current vs Target Coverage:

Module                  Current   Phase 1   Phase 2   Phase 3
────────────────────────────────────────────────────────────
XpcsFile                5%        50%       70%       80%
ViewerKernel            4%        50%       70%       80%
FileIO (hdf_reader)     20%       30%       50%       70%
FileIO (qmap_utils)     40%       50%       60%       75%
G2 Analysis             35%       60%       75%       85%
TwoTime Analysis        30%       50%       70%       80%
SAXS Analysis           40%       60%       75%       85%
────────────────────────────────────────────────────────────
Overall                 ~18%      45%       65%       80%

================================================================================
                         TEST ARCHITECTURE
================================================================================

Recommended Structure:

tests/
├── integration/                    (New - Phase 2)
│   ├── test_g2_analysis_pipeline.py
│   ├── test_saxs_roi_extraction.py
│   ├── test_twotime_analysis.py
│   └── test_memory_management.py
│
├── unit/core/                     (Expand - Phase 1)
│   ├── test_xpcs_file_data_access.py    (NEW)
│   ├── test_xpcs_file_fitting.py        (NEW)
│   ├── test_xpcs_file_export.py         (NEW)
│   ├── test_xpcs_file_roi.py            (NEW)
│   ├── test_xpcs_file_cache.py          (NEW)
│   ├── test_viewer_kernel_plotting.py   (NEW)
│   ├── test_viewer_kernel_export.py     (NEW)
│   ├── test_viewer_kernel_jobs.py       (NEW)
│   ├── test_xpcs_file.py                (EXPAND)
│   └── test_viewer_kernel.py            (EXPAND)
│
├── fixtures/                      (New - Phase 1)
│   ├── xpcs_sample_data.py              (Real HDF5 files)
│   ├── xpcs_mock_data.py                (Synthetic data)
│   └── analysis_parameters.py           (Test parameters)
│
└── [existing test structure]

================================================================================
                         FILE LOCATIONS
================================================================================

Core Legacy Modules:
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/xpcs_file.py (39 methods)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/viewer_kernel.py (28 methods)

Analysis Modules:
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/module/g2mod.py (11 functions)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/module/twotime.py (4 functions)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/module/saxs1d.py (10 functions)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/module/saxs2d.py (1 function)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/module/tauq.py (2 functions)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/module/intt.py (4 functions)

FileIO Modules:
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/fileIO/hdf_reader.py (25+ methods)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/fileIO/qmap_utils.py (20+ methods)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/fileIO/ftype_utils.py (3 functions)
  • /Users/b80985/Projects/xpcsviewer/xpcsviewer/fileIO/aps_8idi.py (specific format)

Current Test Files:
  • /Users/b80985/Projects/xpcsviewer/tests/unit/core/test_xpcs_file.py (39 tests)
  • /Users/b80985/Projects/xpcsviewer/tests/unit/core/test_viewer_kernel.py (50 tests)
  • /Users/b80985/Projects/xpcsviewer/tests/analysis/g2_analysis/ (82 tests)
  • /Users/b80985/Projects/xpcsviewer/tests/analysis/twotime_analysis/ (30 tests)
  • /Users/b80985/Projects/xpcsviewer/tests/analysis/saxs_analysis/ (24 tests)
  • /Users/b80985/Projects/xpcsviewer/tests/unit/fileio/ (135+ tests)

Comprehensive Analysis:
  • /Users/b80985/Projects/xpcsviewer/TEST_COVERAGE_ANALYSIS.md (DETAILED)

================================================================================
                          NEXT STEPS
================================================================================

Immediate Actions (This Sprint):
  1. Review this coverage analysis with team
  2. Create issue tracking for Phase 1 tests (P1)
  3. Set up test data generation utilities
  4. Create assertion helpers for plotting tests
  5. Begin Phase 1 implementation (critical 16 tests)

Ongoing Monitoring:
  • Track coverage % in CI/CD pipeline
  • Set coverage gates (minimum 70% for critical modules)
  • Weekly coverage trending report
  • Flag new code <70% coverage

Long-term Refactoring:
  • Consider decomposing god objects
  • Implement contract/property-based testing
  • Add mutation testing to find weak assertions
  • Establish continuous performance benchmarking

================================================================================
Generated: 2026-01-06
Scope: Legacy component test coverage evaluation
Prepared for: Test Automation & Quality Engineering Review
================================================================================
